<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Inicio - Mi App</title>
  <style>
    body{font-family:system-ui,Arial;padding:20px;background:#f7f9fc}
    header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px}
    .card{background:#fff;padding:16px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.06)}
    button{padding:8px 12px;border-radius:8px;border:0;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <div>
      <strong id="displayName">Usuario</strong>
      <div id="welcomeText" style="font-size:13px;color:#555"></div>
    </div>
    <div>
      <button id="btnLogout">Cerrar sesi칩n</button>
    </div>
  </header>

  <main>
    <section class="card" style="margin-bottom:12px">
      <h4>Mis notas</h4>
      <ul id="notesList"></ul>
      <div style="margin-top:8px">
        <input id="newNoteText" placeholder="Escribe una nueva nota..." style="width:60%" />
        <button id="btnAddNote">A침adir</button>
      </div>
    </section>

    <section class="card">
      <h4>Datos crudos (debug)</h4>
      <pre id="rawData" style="white-space:pre-wrap"></pre>
    </section>
  </main>

  <script>
    const SESSION_KEY  = "fake_session_v1";
    const USER_DATA_KEY = "fake_user_data_v1";
    // redirige al login si no hay sesi칩n
    function getSession(){ const s=localStorage.getItem(SESSION_KEY); return s?JSON.parse(s):null; }
    const session = getSession();
    if (!session || !session.username) {
      // ajusta ruta del login si tu login est치 en index.html u otro nombre
      window.location.href = "index.html";
    } else {
      const username = session.username;
      // carga datos del usuario
      const raw = localStorage.getItem(USER_DATA_KEY);
      const allUsers = raw ? JSON.parse(raw) : {};
      // si no existe el usuario en USER_DATA_KEY, crea entrada por defecto
      if (!allUsers[username]) {
        allUsers[username] = { displayName: username, welcome: `Bienvenido/a ${username}`, notes: [] };
        localStorage.setItem(USER_DATA_KEY, JSON.stringify(allUsers));
      }
      const data = allUsers[username];

      // render
      document.getElementById("displayName").textContent = data.displayName || username;
      document.getElementById("welcomeText").textContent = data.welcome || "";
      const notesList = document.getElementById("notesList");
      const rawDataPre = document.getElementById("rawData");

      function renderNotes() {
        notesList.innerHTML = "";
        (data.notes || []).forEach(n => {
          const li = document.createElement("li");
          li.textContent = n.text;
          // boton eliminar
          const btn = document.createElement("button");
          btn.textContent = "Eliminar";
          btn.style.marginLeft = "8px";
          btn.addEventListener("click", () => {
            data.notes = data.notes.filter(x => x.id !== n.id);
            saveAndRender();
          });
          li.appendChild(btn);
          notesList.appendChild(li);
        });
      }
      function saveAndRender() {
        allUsers[username] = data;
        localStorage.setItem(USER_DATA_KEY, JSON.stringify(allUsers));
        renderNotes();
        rawDataPre.textContent = JSON.stringify(data, null, 2);
      }

      document.getElementById("btnAddNote").addEventListener("click", () => {
        const text = document.getElementById("newNoteText").value.trim();
        if (!text) return;
        const id = Date.now();
        data.notes.push({ id, text });
        document.getElementById("newNoteText").value = "";
        saveAndRender();
      });

      document.getElementById("btnLogout").addEventListener("click", () => {
        localStorage.removeItem(SESSION_KEY);
        window.location.href = "index.html";
      });

      // initial render
      saveAndRender();
    }
  </script>
</body>
</html>
